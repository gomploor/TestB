<project name="Deployment Check Only Targets" default="unknowntarget" basedir="."  xmlns:sf="antlib:com.salesforce"> 
	<taskdef uri="antlib:com.salesforce" resource="com/salesforce/antlib.xml" classpath="lib/ant-salesforce.jar" />
    <taskdef resource="net/sf/antcontrib/antcontrib.properties" classpath="lib/ant-contrib-1.0b3.jar"/>
	<taskdef resource="net/sf/antcontrib/antlib.xml" classpath="lib/ant-contrib-1.0b3.jar"/>
	
    <property file="build_new.properties"/>
	<property environment="env"/>
	
	<!-- Macro RequiredProperty to validate all parameters -->
    <import file="lib/RequiredProperty.xml"/>
	
	<!-- Begin Sandbox Targets -->
	<target name="deployToSandbox" depends="requiredSandBoxProperties">
		<echo message="Deploy to Sandbox action with following parameters set from Jenkins" />
		<echo message= "sf.test.serverurl  >> ${sf.test.serverurl}"/>
		<echo message= "sf.test.username  >> ${sf.test.username}"/>
		<echo message= "sf.test.testlevel  >> ${sf.test.testlevel}"/>
		
		<sf:deploy
			username="${sf.test.username}"
			password="${sf.test.password}"
			serverurl="${sf.test.serverurl}"
			deployRoot="src"
			pollWaitMillis="1000"
			maxPoll="100000"
			CheckOnly="false"
			ignoreWarnings="true"
			testLevel="${sf.test.testlevel}">
		</sf:deploy>		
	</target>
	
	<target name="deployCheckOnlyToSandbox" depends="requiredSandBoxProperties">
		<echo message="Deploy CheckOnly to Sandbox action with following parameters set from Jenkins" />
		<echo message= "sf.test.serverurl  >> ${sf.test.serverurl}"/> 
		<echo message= "sf.test.username  >> ${sf.test.username}"/>
		<echo message= "sf.test.testlevel  >> ${sf.test.testlevel}"/>
		
		<sf:deploy
			username="${sf.test.username}"
			password="${sf.test.password}"
			serverurl="${sf.test.serverurl}"
			deployRoot="src"
			pollWaitMillis="1000"
			maxPoll="100000"
			CheckOnly="true"
			ignoreWarnings="true"
			testLevel="${sf.test.testlevel}">
		</sf:deploy>		
	</target>
	
	<target name="requiredSandBoxProperties">
		<echo message="Checking Required ant attributes" />
		<required-property name="sf.test.serverurl"/>
		<required-property name="sf.test.username"/>
		<required-property name="sf.test.password"/>
		<required-property name="sf.test.testlevel"/>
    </target>
	<!-- Begin Sandbox Targets -->
	
	<!-- Begin Production Targets -->
	<target name="deployCheckOnlyToProduction" depends="requiredProductionProperties">
		<echo message="Deploy CheckOnly to Production action with following parameters set from Jenkins" />
		<echo message= "sf.prod.serverurl  >> ${sf.prod.serverurl}"/>
		<echo message= "sf.prod.username  >> ${sf.prod.username}"/>
		
		<sf:deploy
			username="${sf.prod.username}"
			password="${sf.prod.password}"
			serverurl="${sf.prod.serverurl}"
			deployRoot="src"
			pollWaitMillis="1000"
			maxPoll="100000"
			CheckOnly="true"
			testLevel="RunSpecifiedTests">
			<runTest>OnBoardFormBeforeInsert_Test</runTest>
			<runTest>OnBoardFormControllerExt_Test</runTest>
			<runTest>DigitalAuditExtension_Test</runTest>			
			<runTest>WorkFlowApexRuleHanlder_Test</runTest>	
			<runTest>afteronOpportunityProduct_class</runTest>	
			<runTest>OpportunityLineItemBeforeUpdate_Test</runTest>				
		</sf:deploy>		
	</target>
	
	<target name="deployToProduction" depends="requiredProductionProperties">
		<echo message="Deploy CheckOnly to Production action with following parameters set from Jenkins" />
		<echo message= "sf.prod.serverurl  >> ${sf.prod.serverurl}"/>
		<echo message= "sf.prod.username  >> ${sf.prod.username}"/>
		
		<sf:deploy
			username="${sf.prod.username}"
			password="${sf.prod.password}"
			serverurl="${sf.prod.serverurl}"
			deployRoot="src"
			pollWaitMillis="1000"
			maxPoll="100000"
			CheckOnly="false">
		</sf:deploy>		
	</target>
	
	<target name="quickDeployToProduction" depends="requiredProductionProperties">
		<echo message="Quick Deploy to Production action with following parameters set from Jenkins" />
		<echo message= "sf.prod.serverurl  >> ${sf.prod.serverurl}"/>
		<echo message= "sf.prod.username  >> ${sf.prod.username}"/>
		<echo message= "sf.prod.recentvalidationid  >> ${sf.prod.recentvalidationid}"/>
		<required-property name="sf.prod.recentvalidationid"/>
		
		<sf:deployRecentValidation  
			username="${sf.prod.username}" 
			password="${sf.prod.password}"
			serverurl="${sf.prod.serverurl}" 
			pollWaitMillis="1000"
			maxPoll="100000" 
			recentValidationId="${sf.prod.recentvalidationid}"/>
	</target>
	
	<target name="requiredProductionProperties">
		<echo message="Checking Required ant attributes" />
		<required-property name="sf.prod.serverurl"/>
		<required-property name="sf.prod.username"/>
		<required-property name="sf.prod.password"/>
    </target>
	<!-- Begin Production Targets -->
</project>